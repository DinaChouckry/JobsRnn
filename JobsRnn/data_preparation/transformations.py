import random as rn
from torch import nn
import numpy as np
from numpy.random.mtrand import rand, randint as random_randint, choice as random_choice



class transformation_helpers:
    words = ['الباعه',
             'الزبال',
             'المنتجات',
             'بائع',
             'بحار',
             'بحري',
             'بواب',
             'تاجر',
             'تجهيز',
             'جامع',
             'جامعو',
             'جامعوا',
             'حارس',
             'حراث',
             'حصاد',
             'حفار',
             'حمال',
             'رئيس',
             'راعي',
             'سايس',
             'سائق',
             'سائقو',
             'شغال',
             'شيال',
             'صانع',
             'صناعه',
             'صياد',
             'طحن',
             'طواف',
             'عامل',
             'عزاق',
             'علاف',
             'عمال',
             'عماله',
             'عمل',
             'غواص',
             'فراش',
             'فنيو',
             'قارئ',
             'كاسح',
             'كبير',
             'كناس',
             'ماسح',
             'محصل',
             'مراقب',
             'مزارع',
             'مساعد',
             'مشغل',
             'معاون',
             'معدو',
             'مقلم',
             'ملاحظ',
             'منادي',
             'منسق',
             'منفذ',
             'موزع',
             'موظف',
             'وقاد',
             'المتجولون',
             'الخشبيه',
             '/',
             'ادوات',
             'اقمشه',
             'العاب',
             'بطاقات',
             'تذاكر',
             'جاز',
             'خطوط',
             'زهور',
             'سجاد',
             'شماسه',
             'صحف',
             'عطاره',
             'متجول',
             'مساحيق',
             'ملابس',
             'مناديل',
             'نظارات',
             'عادي',
             'ممتاز',
             'عجله',
             'خرده',
             'الخمور',
             'الدخان',
             'الشاي',
             'الفاكهه',
             'اللحوم',
             'الحطب',
             'المياه',
             'بيض',
             'مواد',
             'القمامه',
             'المهملات',
             'التذاكر',
             'سيارات',
             'يدوي',
             'خدم',
             'جراج',
             'تدريب',
             'ترام',
             'تروسيكل',
             'تريسيكل',
             'جرار',
             'حافله',
             'حيوانات',
             'دراجه',
             'سياره',
             'عربه',
             'قاطره',
             'لوري',
             'مترو',
             'مركبات',
             'مركبه',
             'المركبات',
             'امتعه',
             'السكر',
             'اسماك',
             'الاسماك',
             'الحبوب',
             'غابات',
             '/عامله',
             'اتصالات',
             'استبعاد',
             'اشاره',
             'اعداد',
             'المراسلات',
             'النظافه',
             'انتاج',
             'بيع',
             'تثبيت',
             'تجريف',
             'تجميع',
             'تحصيل',
             'تحويله',
             'تربيه',
             'ترزيم',
             'تركيب',
             'تزييت',
             'تسليك',
             'تسميد',
             'تشغيل',
             'تشهيلات',
             'تشييد',
             'تطريز',
             'تعبئه',
             'تفريخ',
             'تنظيف',
             'توزيع',
             'جلي',
             'جمع',
             'جني',
             'جني-',
             'حزم',
             'حمل',
             'خدمه',
             'خلطه',
             'رش',
             'زراعه',
             'زرعه',
             'سفلته',
             'شاطئ',
             'شحن',
             'شفط',
             'صيانه',
             'عجن',
             'غسيل',
             'غير',
             'فرز',
             'فرمله',
             'فرن',
             'فك',
             'في',
             'قطف',
             'كي',
             'مؤقت',
             'ماكينه',
             'مراعي',
             'مزرعه',
             'مصنع',
             'مقص',
             'مكافحه',
             'مناوله',
             'مهن',
             'هدم',
             'وزن',
             'يجمع',
             'يشغل',
             'التعبئه',
             'الشحن',
             'الكنس',
             'الهندسه',
             'ترتيب',
             'صيد',
             'الاطفال',
             'خيام',
             'مختبرات',
             'العدادات',
             'عداد',
             'الملاحين',
             'الشارع،',
             'احذيه',
             'جدران',
             'زجاج',
             'نقود',
             'ومسؤول',
             'حائز',
             'طباخ',
             'رافعه',
             'معدات',
             'مولدات',
             'الاطعمه',
             'اظافر',
             'صباغه',
             'مناره',
             'حركه',
             'خلطات',
             'علامات',
             'فرشات',
             'منشورات',
             'مطبوعات',
             'مراجل',
             'اطفال',
             'بموقف',
             'يانصيب',
             'وكروت',
             'وكليم',
             'ومجلات',
             'ورق',
             'القياده',
             'والمشروبات',
             'ومنتجاته',
             'والبن',
             'والخضراوات',
             'والاسماك',
             'والخشب',
             'السقا',
             'اعاده',
             'واعاده',
             'النفايات',
             'قياده',
             'بموتور',
             'زراعي',
             'لجر',
             'اتوبيس',
             'مربوطه',
             'ناريه',
             'اجره',
             'ملاكي',
             'ميكروباص',
             'نقل',
             'شاحنه',
             'فان',
             'اليه',
             'سكه',
             'تريك',
             'عام',
             'تدفع',
             'يجرها',
             'والالات',
             'شغاله',
             'بالشباك',
             'والتوابل',
             'لاسلكيه',
             'البضائع',
             'بالسكه',
             'طلاء',
             'المواد',
             'البطاقات',
             'تربه',
             'ونزح',
             'اجهزه',
             'افران',
             'الابواب',
             'الاقفال',
             'الغسالات',
             'حنفيات',
             'سخانات',
             'صناديق',
             'قواطه',
             'لوحات',
             'ماكينات',
             'محولات',
             'مدافئ',
             'مفاتيح',
             'مكونات',
             'منتجات',
             'وتركيب',
             'وحدات',
             'الخاماتتقشير',
             'قوالب',
             'ويشغل',
             'رسوم',
             'احياء',
             'اجزاء',
             'زراير',
             'وتجميع',
             'وتشحيم',
             'المجاري',
             'وري',
             'الات',
             'اله',
             'توربينات',
             'عربات',
             'غلايه',
             'كباس',
             'كراكه',
             'لودر',
             'محطه',
             'مصاعد',
             'مكبس',
             'هويس',
             'ومتابعه',
             'ومراقبه',
             'ونش',
             'واصلاحات',
             'المباني',
             'طرق',
             'الي',
             'وتغليف',
             'ابراج',
             'احواض',
             'الاثاث',
             'الالات',
             'النوافذ',
             'حظائر',
             'عبوات',
             'علي',
             'محطات',
             'مفروشات',
             'وصباغه',
             'وكي',
             'الجرائد',
             'المحاصيل',
             'بذور',
             'نباتات',
             'وتجهيز',
             '-',
             'وتسميه',
             'الفحم',
             'بالطريق',
             'حدائق',
             'خرسانيه',
             'الطرق',
             'مبيدات',
             'السدود',
             'الطفله',
             'الصحون',
             'ستائر',
             'وتنظيف',
             'ماهر',
             'الزجاجات',
             'وترتيب',
             'تحضير',
             'صهر',
             'وربط',
             'الغابات',
             'اماكن',
             'وتدريج',
             'مكوي',
             'باليد',
             'تسويه',
             'كشط',
             'طيور',
             'ماشيه',
             'مناول',
             'وتقليم',
             'حرائق',
             'فرديه',
             'وحزم',
             'ويركب',
             'المنشار',
             'وحده',
             'اليدويه',
             'والتفريغ',
             'ومن',
             'وموزعو',
             'الاخرون',
             'المنزليه',
             'المدنيه',
             'اواني',
             'الماشيه',
             'بالحدائق',
             'تعليميه',
             'الكهرباء',
             'مياه',
             'المطار،',
             'وارضيات',
             'عن',
             'متخصص',
             'بناء',
             'الحاويات',
             'ارضيه',
             'القوي',
             'الابقار',
             'اسفلت',
             'المرور',
             'اسفلتيه',
             'بخاريه',
             'عدا',
             'انابيب',
             'التنظيف',
             'السيارات',
             'كيروسين',
             'مقود',
             'البحر',
             'شرابات',
             'ولاعات',
             'دومنجي',
             'الروحيه',
             'والكاكاو',
             'والجوزيات',
             'التدوير',
             'تدويرها',
             'المنزل',
             'ذات',
             'ذو',
             'جذوع',
             'بالات',
             'موتوسيكل',
             'تاكسي',
             'اسعاف',
             'مغطي',
             'مكشوف',
             'او',
             'ثقيل',
             'حديد',
             'المناجم',
             'حيوان',
             'التي',
             'خادم',
             'البيتزا',
             'الهامبورجر',
             'ساندوتشات',
             'فول',
             'مشروبات',
             'مشويات',
             'التالفه',
             'الحديد',
             'الخزف',
             'الطائره',
             'القابله',
             'الارشاديه',
             'الثلوج',
             'التبريد',
             'تسخين',
             'غاز',
             'الجلديه',
             'المنشر',
             'كهربائيه',
             'صندوق',
             'ومستلزمات',
             'الغزل',
             'الورق',
             'الاسلحه',
             'مصابيح',
             '–',
             'قص',
             'مواقف',
             'مائيه',
             'الطائرات',
             'والبالوعات',
             'تسجيل',
             'التذريه',
             'الحرث',
             'عدد',
             'رفع',
             'لحمل',
             'مكوك',
             'الطوب',
             'تحميص',
             'حرق',
             'الهواء',
             'خلط',
             'ازاله',
             'التجفيف',
             'التغليف',
             'الكابلات',
             'اللصق',
             'تبييض',
             'تشذيب',
             'تشطيب',
             'تصنيع',
             'تعتيق',
             'تنعيم',
             'حبكه',
             'حفر',
             'حياكه',
             'خط',
             'خياطه',
             'دباغه',
             'درزه',
             'دق',
             'دك',
             'رصف',
             'شكه',
             'صقل',
             'ضغط',
             'عراوي',
             'فتح',
             'فرش',
             'فقاقيع',
             'كاسحه',
             'كبس',
             'كمش',
             'لف',
             'لقطه',
             'معالجه',
             'نقش',
             'هراس',
             'حراريه',
             'الرش',
             'الري',
             'تخريم',
             'الغلايات',
             'برجي',
             'ثابت',
             'حصيره',
             'ذي',
             'طبليه',
             'قفص',
             'كوبري',
             'متحرك',
             'محمل',
             'للمنتجات',
             'السباحه',
             'سمك',
             'المنجد',
             'وموكيت',
             'الجاف',
             'وسائل',
             'وستائر',
             'السجاد',
             'والمجلات',
             'مطبخ',
             'بريه',
             'المنتج',
             'العام',
             'وبساتين',
             'زينه',
             'اشجار',
             'تحميل',
             'العادمه',
             'والاواني',
             'ومفروشات',
             'وتلميع',
             'الكهنه',
             'الزجاج',
             'السفن',
             'ازهار',
             'اسطوانه',
             'باسقاط',
             'الارض',
             'نحل',
             'للمواد',
             'اطارات',
             'التوربينات',
             'الدراجات',
             'الدعامات',
             'الستائر',
             'العربات',
             'الكهروميكانيكيه',
             'المحركات',
             'المعدات',
             'المكونات',
             'الهاتف',
             'زجاجه',
             'لعب',
             'محركات',
             'وتشغيل',
             'الحزامي',
             'بلوره',
             'تشكيل',
             'البلوره',
             'التبخير',
             'التخريم',
             'التسميك',
             'التسويه',
             'الجبن',
             'الحقائب',
             'الحلوي',
             'السروح',
             'الغسيل',
             'المشروبات',
             'المكرونه',
             'النشر',
             'برش',
             'برم',
             'بستره',
             'تتبيل',
             'تجفيف',
             'تجميد',
             'تحميد',
             'تخليل',
             'تخمير',
             'تزرير',
             'تصفيه',
             'تطبيع',
             'تعقيم',
             'تعليب',
             'تفصيل',
             'تقشير',
             'تقطير',
             'تقطيع',
             'تكرير',
             'تمليح',
             'تنقيه',
             'حقائب',
             'سحب',
             'شد',
             'صنع',
             'طبخ',
             'عصاره',
             'عصر',
             'عصير',
             'غسل',
             'فتق',
             'فرم',
             'فريزا',
             'قطع',
             'كلندره',
             'لب',
             'مزج',
             'مناخل',
             'نقر',
             'هدرجه',
             'هضم',
             'مجففات',
             'الذين',
             'اليدوي',
             'اليهم',
             'الطرود',
             'الفندق',
             'المكاتب',
             'المكتب',
             'البذار',
             'التسميد',
             'الحصاد',
             'تجليد',
             'تخريس',
             'تذهيب',
             'تصفيح',
             'تغليف',
             'سلفنه',
             'طباعه',
             'طي',
             'الحقليه',
             'والاحياء',
             'الملابس',
             'والنفايات',
             'والبساتين',
             'التشييد',
             'الزراعه',
             'و',
             'البحاره',
             'المحطه،',
             'وسلالم',
             'البيع',
             'ارشاد',
             'الوجبات',
             'اعلانات',
             'عطشجي',
             'ما',
             'منزليه',
             'ومواد',
             'بوتاجاز',
             'بمبوطي',
             'الاخري',
             'بدال',
             'مقطوره',
             'الاشجار',
             'لاداء',
             'قلاب',
             'والمحاجر',
             'بمقطوره',
             'حنطور',
             'تجرها',
             'البوص',
             'وطعميه',
             'بارده',
             'ساخنه',
             'دجاج',
             'السكك',
             'للتدوير',
             'والعلامات',
             'التروس',
             'والنسيج',
             'الخام',
             'والذخيره',
             'فلوريه',
             'وتحريز',
             'محولجي',
             'الارفف',
             'معدنيه',
             'والمعدات',
             'بيانات',
             'والجني',
             'ميكانيكيه',
             'الاثقال',
             'رولات',
             'الاخشاب',
             'بالمناجم',
             'السفينه',
             'والبلاط',
             'ضاغط',
             'جراف',
             'وخلط',
             'الشعر',
             'صمغ',
             'بين',
             'ووضع',
             'الديكاتور',
             'رقائق',
             'المنسوجات',
             'اللون',
             'ازرار',
             'اوفر',
             'اللمبات',
             'اتوماتيكيه',
             'صناعيه',
             'سوائل',
             'مساحي',
             'وغسيل',
             'انفاق',
             'خنادق',
             'سطحي',
             'الفراء',
             'القبعات',
             'المفروشات',
             'الاسفلت',
             'الخرسانه',
             'دائري',
             'متعدده',
             'الجلود',
             'الخوازيق',
             'وتسويه',
             'وتوزيع',
             'وتحميل',
             'الالياف',
             'الياف',
             'خيوط',
             'الملفات',
             'الاقمشه',
             'وتعبئه',
             'وغلق',
             'الالومنيوم',
             'تحضيرات',
             'الحرير',
             'الطريق',
             'معادن',
             'زجاجيه',
             'لبناء',
             'برج',
             'بكره',
             'صاري',
             'واغلاق',
             'النقل',
             'بالجمله',
             'للتخزين',
             'الخضر',
             'للمنازل',
             'الحدائق',
             'وشجيرات',
             'سفن',
             'شاحنات',
             'جوي',
             'ومنتجات',
             'رباطه',
             'العمله',
             'محدده',
             'النظارات',
             'المعدني',
             'الزراعيه',
             'الصناعيه',
             'الميكانيكيه',
             'الانشائيه',
             'البحريه',
             'البخاريه',
             'الالكترونيه',
             'السمعيه',
             'الكهربائيه',
             'المعدنيه',
             'الترموس',
             'الدوائر',
             'التعدين',
             'الطباعه',
             'المشغولات',
             'الاحتراق',
             'تحريك',
             'الانتاج',
             'المظلات',
             'البلاستيك',
             'المطاط',
             'وتقطيع',
             'شرائط',
             'تدوير',
             'دبغ',
             'جرش',
             'لصناعه',
             'بعد',
             'فاره',
             'رابوه',
             'بانواعه',
             'بانواعها',
             'بالبخار',
             'منشره',
             'الخبز',
             'الدقيق',
             'الشكولاته',
             'علف',
             'التبغ',
             'الالبان',
             'عجينه',
             'الارز',
             'الخضراوات',
             'محلول',
             'حبوب',
             'الخضروات',
             'الخشب',
             'اعواد',
             'البوظه',
             'الحمص',
             'الطحينه',
             'الفول',
             'القهوه',
             'سواك',
             'اللفائف',
             'نعال',
             'وجرش',
             'وعصير',
             'وتخمير',
             'جاف',
             'صنفره',
             'وتصفيه',
             'السفر',
             'البن',
             'نعل',
             'وجه',
             'كعب',
             'الاحذيه',
             'البسكويت',
             'البيره',
             'التورتات',
             'الحلاوه',
             'الخيام',
             'السيجار',
             'الكحوليات',
             'اللبان',
             'اللبن',
             'المربات',
             'النبيذ',
             'النماذج',
             'خميره',
             'زيوت',
             'وتقطير',
             'الخضراوات/',
             'وتنقيه',
             'التوابل',
             'الطماطم',
             'خشب',
             'نماذج',
             'القشره',
             'اوراق',
             'الملبوسات',
             'الزيوت',
             'استخلاص',
             'صهاريج',
             'لم',
             'وشيالو',
             'والفنادق',
             'وتغريه',
             'بالسلك',
             'الاستمارات',
             'ملازم',
             'اطباق',
             'دبوس',
             'وتخريز',
             'الكتب',
             'اوفست',
             'بارزه',
             'غائره',
             'ملونه',
             'منسوجات',
             'شريطي',
             'محدود',
             'المائيه',
             'الطيور',
             'وتربيه',
             'والبناء',
             'المختلطه',
             'الحديقه...',
             'واسطح',
             'الناس',
             'اللب',
             'المطار',
             'تعمل',
             'السريعه',
             'حره',
             'محرك',
             'الغذائيه',
             'قفازات',
             'شباشب',
             'الاعمال',
             'مغطاه',
             'لمسافات',
             'الحيوانات',
             'خادمه',
             'والكرتون',
             'والماكينات',
             'حصر',
             'شوكه',
             'ونقلها',
             'والسيراميك',
             'والصيني',
             'حلاقه',
             'مراحل',
             'العلامات',
             'الحبال',
             'السليكون',
             'الحراريه',
             'وسجاد',
             'الزجاجيه',
             'الجينز',
             'حفاره',
             'الجاهزه',
             'التليفزيون',
             'الراديو',
             'الابر',
             'بالخرسانه',
             'الاتربه',
             'ياقه',
             'النسيجيه',
             'النسيج',
             'مزلقان',
             'بالاسفلت',
             'مقصدار',
             'الخياطه',
             'لزياده',
             'ضد',
             'جريدر',
             'المساكن',
             'وسيور',
             'ارصفه',
             'الرجل',
             'البالات',
             'البساتين',
             'ناقلات',
             'خضروات',
             'الشوارع',
             'المطابخ',
             'للمركبات',
             'القصب',
             'مخلفات',
             'رول',
             'الشاحنات',
             'الدقيقه',
             'من',
             'المطبوعه',
             'المعادن',
             'الداخلي',
             'التربه',
             'المجوهرات',
             'اقلام',
             'السمندر',
             'الشريطي',
             'الزينه',
             'البذور',
             'خلاصه',
             'المغسله',
             'والاحزمه',
             'الاطواق',
             'المسكره',
             'الشعريه',
             'الادمه',
             'وتمليحها',
             'بجميع',
             'تفتيح',
             'الدباغه',
             'غلي',
             'الثقاب',
             'بالطحينه',
             'المدمس',
             'سريعه',
             'يدويه',
             'الاسنان',
             'الحميد',
             'وغربله',
             'السمسم',
             'العنب',
             'الاخضر',
             'الحذاء',
             'والسكاكر',
             'الكحوليه',
             'والكعك',
             'الطحينيه',
             'روح',
             'المركز',
             'الباترونات',
             'الجوزيات',
             'الطحين',
             'المخابز',
             'لحوم',
             'الخل',
             'الحبيبي',
             'شق',
             'طحين',
             'والدهون',
             'يعمل',
             'العصائر',
             'تطهير',
             'يرد',
             'الامتعه',
             'وغيرها',
             'والتخزين',
             'الغرس',
             'اللولبي',
             'ليثوغرافي',
             'تيبو',
             'بالرول',
             'الفلسكو',
             'متصله',
             'شيتر',
             'المهاره',
             'محدودي',
             'والمواشي',
             'مخبريه',
             'للمخارج',
             'البقوليات',
             'بالمراجل',
             'الخشبي',
             'اعلام',
             'خمور',
             'المختلفه',
             'طويله',
             'دولي',
             'الاستخدام',
             'يشارك',
             'البهارات',
             'الثابته',
             'والفخار',
             'الطبيعي',
             'الصباغه',
             'الرام',
             'الفلورسنت',
             'تاسيس',
             'بالسيارات',
             'ورش',
             'الجليد',
             'وزنه',
             'تسرب',
             'عائمه',
             'سكك',
             'القدم',
             'والمشاتل',
             'والطائرات',
             'الرصاص',
             'لقطع',
             'والورق',
             'والتلحيم',
             'وطبخها',
             'المراحل',
             'الشغير',
             'بوظه',
             'الذوبان',
             'نكاشات',
             'وما',
             'وغير',
             'والفطائر/',
             'الخمر',
             'علكه',
             'مثل',
             'الخنزير',
             'المولت',
             'الطعام',
             'غسلها',
             'تسحيب',
             'الابلكاش',
             'تحت',
             'السكريه',
             'تصنيفهم',
             'بالطبق',
             'وصيانه',
             'والمواد',
             'السجائر',
             'محلي',
             'والنكهات',
             'بالمصنع',
             'للنسيج',
             'الطبقه',
             'حديديه',
             'للحواسب',
             'الاطقم',
             'ترطيب',
             'عربيه',
             'حفظ',
             'الكنافه',
             'النشا',
             'المعجنات',
             'قصب',
             'اشراف',
             'السائل',
             'مساعدون',
             'الطوارئ',
             'المشابهه',
             'وتجفيف',
             'سلق،',
             'وفصل',
             'والتي',
             'DVD',
             'للطرق',
             'والمحركات',
             'الخ',
             'توليف',
             'فاكهه',
             'القطايف',
             'والمكسرات',
             'وترشح',
             'لانتاج',
             'يثبت',
             'تدخل',
             'الممهده',
             'القمح',
             'البسطرمه',
             'النخيل',
             'عناصر',
             'مدخله',
             'الكاكاو',
             'والنقانق',
             'والوجبات',
             '...',
             'اي',
             'بحسب',
             'التعليمات',
             'ويطبق',
             'تعليمات',
             'السلامه',
             'والصحه',
             'المهنيه',
             'اخري',
             'سائله',
             'صلبه',
             'نزع',
             'سيقان',
             'توليفه',
             'وعلف',
             'الحيوان',
             'لوجبات', ]
    # pad must be index 0
    vocab_list = ['<pad>', '<sos>', '<unk>', '<eos>'] + words
    vocab = dict((c, i) for i, c in enumerate(vocab_list))
    inv_vocab = dict((i, c) for i, c in enumerate(vocab_list))

    @classmethod
    def string_to_int(cls, sentence, add_sos = True, add_eos=True):
        # switch sentence to indices and add <sos> , <eos>
        # sentence = list(sentence)
        # print('sentence 2 ',sentence)
        # TODO: switch back to error
        ints = list(map(lambda x: cls.vocab.get(x, cls.vocab['<unk>']), str(sentence).split()))
        ints = [cls.vocab['<sos>']] + ints if add_sos else ints
        ints = ints + [cls.vocab['<eos>']] if add_eos else ints
        return ints


    @classmethod
    def int_to_string(cls, ints):
        # switch indices back to sentence and remove  <sos> , <eos>
        sos_index = ints.index(cls.vocab['<sos>'])
        eos_index = ints.index(cls.vocab['<eos>']) if cls.vocab['<eos>'] in ints else -1
        sentence = [cls.inv_vocab.get(i, ".") for i in ints[sos_index+1:eos_index]]
        return sentence


    @classmethod
    def generate_embedding(cls, args):
        word_embedding = nn.Embedding(len(cls.vocab_list), args.embedding_vec_size, padding_idx=cls.vocab['<pad>'])
        # if args.fixed_embeddings:
        #     word_embedding.weight.requires_grad = False
        return word_embedding




class ToIdx:
    def __init__(self, args, add_sos=True, add_eos=True):
        self.args = args
        self.add_sos = add_sos
        self.add_eos = add_eos

    def __call__(self, pair):
        x_idx = transformation_helpers.string_to_int(pair[0], self.add_sos, self.add_eos)
        return (pair[0],pair[1],x_idx )





